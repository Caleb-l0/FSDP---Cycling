<!DOCTYPE html>
<html lang="en">    
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>My Profile | HappyVolunteer</title>
<link rel="stylesheet" href="profilepage.css">

</head>
<body>
<header>
  <div class="container">
    <div class="header-content">
      <a href="homepage.html" class="logo">Happy Volunteer</a>
      <button class="nav-toggle" id="navToggle">
        <i class="fas fa-bars"></i>
      </button>
      <nav id="mainNav">
        <ul>
          <li><a href="#">Event</a></li>
          <li><a href="#">Community</a></li>
          <li><a href="#">Reward</a></li>
          <li><a href="profilepage.html">Profile</a></li>
        </ul>
      </nav>
    </div>
  </div>
</header>

<!-- Language Switcher -->
<div class="lang-container">
  <button class="lang-btn" onclick="translatePage('en')">English</button>
  <button class="lang-btn" onclick="translatePage('zh-CN')">Chinese</button>
  <button class="lang-btn" onclick="translatePage('ms')">Malay</button>
  <button class="lang-btn" onclick="translatePage('ta')">Tamil</button>
</div>

<section class="hero">
  <div class="profile-card">

    <img src="https://cdn-icons-png.flaticon.com/512/847/847969.png" 
         class="profile-avatar"
         alt="Profile Picture">

    <h2>Your Profile</h2>

    <p><strong>Name</strong><br>
      <input type="text" id="name" disabled>
    </p>

    <p><strong>Email</strong><br>
      <input type="email" id="email" disabled>
    </p>

    <p><strong>Role:</strong>
      <span id="role"></span>
    </p>

    <button class="btn" id="editBtn">Edit</button>
    <button class="btn" id="saveBtn" style="display:none;">Save</button>
    <button class="btn logout-btn" id="logoutBtn">Logout</button>

  </div>
</section>

<script>
const token = localStorage.getItem("token");

if (!token) {
  alert("You must be logged in to access this page.");
  window.location.href = "/index.html";
}

// Load profile
async function loadProfile() {
  try {
    const response = await fetch("http://localhost:3000/api/profile", {
      method: "GET",
      headers: { "Authorization": `Bearer ${token}` }
    });
    if (!response.ok) throw new Error("Unauthorized");
    const data = await response.json();

    document.getElementById("name").value = data.name;
    document.getElementById("email").value = data.email;
    document.getElementById("role").textContent = data.role;

  } catch (err) {
    console.error(err);
    alert("Session expired â€” please log in again.");
    window.location.href = "/index.html";
  }
}
loadProfile();

// Edit / Save
const nameField = document.getElementById("name");
const emailField = document.getElementById("email");
const editBtn = document.getElementById("editBtn");
const saveBtn = document.getElementById("saveBtn");

editBtn.addEventListener("click", () => {
  nameField.disabled = false;
  emailField.disabled = false;
  editBtn.style.display = "none";
  saveBtn.style.display = "inline-block";
});

saveBtn.addEventListener("click", async () => {
  const newName = nameField.value;
  const newEmail = emailField.value;

  try {
    const response = await fetch("http://localhost:3000/api/profile", {
      method: "PUT",
      headers: { "Content-Type": "application/json", "Authorization": `Bearer ${token}` },
      body: JSON.stringify({ name: newName, email: newEmail })
    });
    if (!response.ok) throw new Error("Update failed");
    alert("Profile updated successfully!");
    nameField.disabled = true;
    emailField.disabled = true;
    editBtn.style.display = "inline-block";
    saveBtn.style.display = "none";
  } catch (err) {
    console.error(err);
    alert("Error updating profile.");
  }
});

// Logout button
const logoutBtn = document.getElementById("logoutBtn");
logoutBtn.addEventListener("click", () => {
  localStorage.clear();
  alert("Logged out successfully!");
  window.location.href = "/index.html";
});
</script>
</body>
</html>
