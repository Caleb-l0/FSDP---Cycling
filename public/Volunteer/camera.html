<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>QR Scanner</title>
  <style>
    body { display:flex; flex-direction:column; align-items:center; justify-content:center; height:100vh; margin:0; background:#f4f4f4; }
    #cameraBox { width:90vw; max-width:600px; aspect-ratio:4/3; background:#000; border-radius:12px; overflow:hidden; }
    video { width:100%; height:100%; object-fit:cover; }
    button { margin-top:12px; padding:10px 16px; font-size:16px; border:none; border-radius:8px; background:#007bff; color:white; cursor:pointer; }
  </style>
</head>
<body>
  <h3>QR Scanner</h3>
  <div id="cameraBox">
    <video id="video" autoplay playsinline></video>
  </div>
  <button id="flipBtn">Flip Camera</button>

  <!-- ZXing library -->
  <script type="module">
    import { BrowserMultiFormatReader } from 'https://cdn.jsdelivr.net/npm/@zxing/library@0.19.1/esm/index.min.js';

    const video = document.getElementById('video');
    const flipBtn = document.getElementById('flipBtn');
    let usingFront = false;

    const codeReader = new BrowserMultiFormatReader();

    async function startScanner() {
      try {
        const constraints = { video: { facingMode: usingFront ? 'user' : 'environment' } };
        const stream = await navigator.mediaDevices.getUserMedia(constraints);
        video.srcObject = stream;

        // Start decoding continuously
        codeReader.decodeFromVideoElement(video, (result, err) => {
          if (result) {
            console.log('QR detected:', result.getText());
            alert('QR detected: ' + result.getText());
            // Stop scanning if you want
            // codeReader.reset();
          }
        });
      } catch (err) {
        console.error(err);
        alert('Cannot access camera');
      }
    }

    flipBtn.addEventListener('click', () => {
      usingFront = !usingFront;
      codeReader.reset();
      startScanner();
    });

    startScanner();
  </script>
</body>
</html>

