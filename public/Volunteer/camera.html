<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>QR Scanner</title>
  <style>
    body { display:flex; flex-direction:column; align-items:center; justify-content:center; height:100vh; margin:0; background:#f4f4f4; }
    #cameraBox { width:90vw; max-width:600px; aspect-ratio:4/3; background:#000; border-radius:12px; overflow:hidden; }
    video { width:100%; height:100%; object-fit:cover; }
    button { margin-top:12px; padding:10px 16px; font-size:16px; border:none; border-radius:8px; background:#007bff; color:white; cursor:pointer; }
  </style>
</head>
<body>
  <h3>QR Scanner</h3>
  <div id="cameraBox">
    <video id="video" autoplay playsinline></video>
  </div>
  <button id="flipBtn">Flip Camera</button>

  <!-- ZXing library -->
  <script type="module">
  import { BrowserMultiFormatReader } from 'https://cdn.jsdelivr.net/npm/@zxing/library@0.19.1/esm/index.min.js';

  const video = document.getElementById('video');
  const flipBtn = document.getElementById('flipBtn');

  let usingFront = false;
  let codeReader = new BrowserMultiFormatReader();

  async function startScanner() {
    codeReader.reset();

    const constraints = {
      video: {
        facingMode: usingFront ? 'user' : 'environment'
      }
    };

    try {
      await codeReader.decodeFromConstraints(
        constraints,
        video,
        (result, err) => {
          if (result) {
            console.log("QR:", result.getText());
            alert("QR detected:\n" + result.getText());

            // Stop scanning after success
            codeReader.reset();
          }
        }
      );
    } catch (e) {
      console.error(e);
      alert("Camera error");
    }
  }

  flipBtn.onclick = () => {
    usingFront = !usingFront;
    startScanner();
  };

  startScanner();
</script>
